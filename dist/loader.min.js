!function(t){"use strict";var e={isIE:function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("msie")!=-1&&parseInt(t.split("msie")[1])},getType:function(t){return Object.prototype.toString.call(t)},proxy:function(t,e){if(t)return function(){return t.apply(e||this,arguments)}},forEach:function(t,e){if(t)if(t.forEach)t.forEach.call(t,e);else{var n=this.getType(t);if("[object Array]"===n){for(var r=0;r<t.length;r++)if(e.call(t[r],t[r],r)===!1)return}else if("[object Object]"===n)for(var r in t)if(t.hasOwnProperty(r)&&e.call(t[r],t[r],r)===!1)return}},console:function(e){var n=t.console;return n?n:{log:function(){},warn:function(){}}}(),uuid:function(){for(var t=[],e="0123456789ABCDEF",n=0;n<36;n++)t[n]=e.substr(Math.floor(16*Math.random()),1);t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-";var r=t.join("");return r},extend:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},ajax:function(e){var n=null;if(t.XMLHttpRequest)n=new t.XMLHttpRequest;else if(t.ActiveXObject)try{n=new t.ActiveXObject("Msxml2.XMLHTTP")}catch(e){n=new t.ActiveXObjec("Microsoft.XMLHTTP")}if(null!==n){e=this.extend({method:"GET",url:null,data:null,isAsync:!0,success:null,error:null},e);var r="";"GET"===e.method&&"[object Object]"===this.getType(e.data)&&(this.forEach(e.data,function(e,n){r+=n+"="+t.encodeURIComponent(e)+"&"}),r=r.substr(0,r.length-1),e.url.indexOf("?")>=0?e.url+="&"+r:e.url+="?"+r),n.open(e.method,e.url,e.isAsync),"GET"===e.method?n.send(null):"POST"===e.method&&n.send(r),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?e.success&&e.success(n.responseText):e.error&&e.error())}}},addEvent:function e(){return document.addEventListener?function(t,n,r){if(t.length)for(var o=0;o<t.length;o++)e(t[o],n,r);else t.addEventListener(n,r,!1)}:function(n,r,o){if(n.length)for(var s=0;s<n.length;s++)e(n[s],r,o);else n.attachEvent("on"+r,function(e){return o.call(n,e||t.event)})}}(),isDocument:function(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE},qsa:function(t,n){var r,o="#"==n[0],s=!o&&"."==n[0],i=o||s?n.slice(1):n,u=/^[\w-]*$/.test(i);return e.isDocument(t)&&u&&o?(r=t.getElementById(i))?[r]:[]:1!==t.nodeType&&9!==t.nodeType?[]:Array.prototype.slice.call(u&&!o?s?t.getElementsByClassName(i):t.getElementsByTagName(n):t.querySelectorAll(n))},matches:function(t,n){if(!n||!t||1!==t.nodeType)return!1;var r=t.webkitMatchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(r)return r.call(t,n);var o,s=t.parentNode,i=document.createElement("div"),u=!s;return u&&(s=i).appendChild(t),o=~e.qsa(s,n).indexOf(t),u&&i.removeChild(t),o}},n={ProcessStatus:{NOSTART:0,RUNNING:1,PAUSE:2,COMPLETE:3,ERROR:4},ProcessCommand:{PAUSE:0,STOP:1,NONE:2},FileStatus:{NOSTART:0,RUNNING:1,ERROR:2,COMPLETE:3}},r=function(t){this.conf=e.extend({},t),this.handler={onComplete:null,onError:null},this._file={},this._status=n.FileStatus.NOSTART;var r=navigator.userAgent;this._isIE=r.indexOf("MSIE")>=0,this._body=document.body||document.getElementsByTagName("body")[0]};r.prototype={constructor:r,_onload:function(){this._status=n.FileStatus.COMPLETE,this.runHandler(this.handler.onComplete,this._file)},_onerror:function(){this._status=n.FileStatus.ERROR,this.runHandler(this.handler.onError,this._file)},status:function(){var t=arguments[0];return void 0===t?this._status:void(this._status=t)},process:function(t){if(this._file=t,this._file.url){var r=null;return this._status=n.FileStatus.RUNNING,this._isIE?(r=new Image,r.src=this._file.url,r.onload=e.proxy(this._onload,this),r.onerror=e.proxy(this._onerror,this)):(r=document.createElement("object"),r.data=this._file.url,r.width=0,r.height=0,r.onload=e.proxy(this._onload,this),r.onerror=e.proxy(this._onerror,this),this._body.appendChild(r)),this}},bind:function(t,e){return this.handler[t]=e,this},runHandler:function(t,e){return t&&t(e),this}};var o=function(t){this.conf=e.extend({},t),this._cache=[],this._complete=[],this.handler={onItemComplete:null,onItemStart:null,onItemError:null,onComplete:null,onStart:null,onError:null,onPause:null}};o.prototype={constructor:o,_createLoader:function(){var t=new r;return t.bind("onComplete",e.proxy(this._onItemComplete,this)).bind("onError",e.proxy(this._onItemError,this))},_getLoader:function(){for(var t=null,e=0;e<this._cache.length;e++){var r=this._cache[e];if(r.status()!==n.FileStatus.RUNNING){t=r;break}}return null===t&&(t=this._createLoader(),this._cache.push(t)),t},_onItemComplete:function(t){this.runHandler(this.handler.onItemComplete,t.url),this._complete.push(t),this._toComplete(),this._toContinue(),this._toPause()},_onItemError:function(t){this.runHandler(this.handler.onItemError,t.url).runHandler(this.handler.onError,t),this._toComplete(),this._toContinue(),this._toPause()},_toComplete:function(){return 0===this._queue.length&&this._status!==n.ProcessStatus.COMPLETE&&(this._status=n.ProcessStatus.COMPLETE,this.runHandler(this.handler.onComplete),!0)},_toContinue:function(){this._status!==n.ProcessStatus.COMPLETE&&this._command==n.ProcessCommand.NONE&&this._process({queue:this._queue})},_toPause:function(){this._command===n.ProcessCommand.PAUSE&&this._status===n.ProcessStatus.RUNNING&&(this._status=n.ProcessStatus.PAUSE,this.runHandler(this.handler.onPause))},_process:function(){if(this._queue&&(this._command=n.ProcessCommand.NONE,this._status=n.ProcessStatus.RUNNING,!this._toComplete()&&this._queue.length>0)){var t=this._getLoader();if(null!==t){var e=this._queue.pop();e&&(this.runHandler(this.handler.onItemStart,e.uri),t.process({url:e.uri,type:e.type}))}}},process:function(t){return this._queue=t.queue,this.runHandler(this.handler.onStart),this._process(),this},pause:function(){return this._command=n.ProcessCommand.PAUSE,this},goOn:function(){return this._process({queue:this._queue}),this},bind:function(t,e){return this.handler[t]=e,this},runHandler:function(t,e){return t&&t(e),this}};var s={load:function(t){var n=t.resources||null;if(null===n||!n.length)return void e.console.warn("依赖资源列表为空，本次将不预加载任何内容！");var r={},s=new o;e.uuid();s.bind("onStart",function(){e.console.log("开始下载")}).bind("onItemStart",function(t){var e=new Date,n=e.getTime();r[t]={},r[t].startTime=n}).bind("onItemComplete",function(t){var n=new Date,o=n.getTime();r[t]&&(r[t].endTime=o),e.console.log("资源 "+t+"下载完成！")}).bind("onItemError",function(t){e.console.log("资源 "+t+"下载失败！")}).bind("onComplete",function(){e.console.log(r)}).process({queue:n})}},i=e.isIE();(!i||i>=8)&&(t.onload=function(){var n=t.hermesConf;e.ajax({method:"GET",url:n.resUrl,success:function(t){try{t=JSON.parse(t)}catch(e){t=null}t&&s.load(t)}})})}(window);